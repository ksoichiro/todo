@(form: Form[views.formdata.TodoForm])

@main("TODO") {

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="@routes.Todo.index()">TODO</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="username">@session.get("username")</span>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="/logout">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">

    <div class="form-group">
        @helper.form(routes.Todo.create(), 'id -> "newTodo", 'class -> "form-inline") {
            <label class="sr-only" for="title">Title:</label>
            <input type="text" id="title" placeholder="Title" class="form-control" />
            <label class="sr-only" for="note">Note:</label>
            <input type="text" id="note" placeholder="Note" class="form-control" />
            <input type="submit" class="btn btn-primary" value="Save" />
            <div class="alert alert-warning">Error</div>
        }
    </div>

    <table class="table table-hover">
        <thead>
        <th>Id</th>
        <th>Title</th>
        <th>Status</th>
        <th>Note</th>
        <th>&nbsp;</th>
        </thead>
        <tbody>
        </tbody>
    </table>

    <!-- Modal -->
    <div class="modal fade" id="dialog_confirm_delete" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
                        Warning</h4>
                </div>
                <div class="modal-body">
                    Are you sure to delete this TODO?
                </div>
                <div class="modal-footer">
                    <button type="button" class="negative btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="positive btn btn-danger" data-dismiss="modal" data-delete="#">Delete</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script language="javascript">
    $(function () {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        $(document).ajaxSend(function(e, xhr, options) {
           xhr.setRequestHeader(header, token);
        });

        $('#dialog_confirm_delete').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget)
            var deleteTarget = button.data('delete')
            var modal = $(this)
            modal.find('.modal-footer button.positive').attr('data-delete', deleteTarget)
        })
        $('#dialog_confirm_delete .modal-footer .positive').on('click', function() {
            $('#dialog_confirm_delete').modal('hide')
            var deleteTarget = $('#dialog_confirm_delete .modal-footer button.positive').attr('data-delete')
            $('#delete' + deleteTarget).submit();
        })
    });
    function editTodo(entityId, td, id) {
        var child;
        var text;
        if ($(td).children().length == 0) {
            text = $(td).text();
            $(td).text('');
            child = $("<input />", {
                'id': id,
                'value': text,
                'class': 'form-control'
            });
            child.appendTo($(td));
        } else if ($(td).children().first().is(':visible')) {
            return;
        } else {
            $(td).text('');
            child = $(td).children().first();
            child.show();
        }
        child.focusout(function() {
            if (child.val().length == 0) {
                $(td).text(text);
                child.hide();
            } else {
                var params = {};
                params['id'] = entityId;
                params[id] = child.val();
                $.ajax({
                    type: 'POST',
                    datatype : "json",
                    contentType: "application/json; charset=utf-8",
                    url: '/todos/' + entityId + '/update',
                    data: JSON.stringify(params),
                    success: function(data) {
                        $(td).text(child.val());
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        $(td).text(text);
                    }
                });
            }
        });
        child.focus();
    }
</script>

}
