<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head lang="en">
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>TODO</title>
    <link rel="stylesheet" type="text/css" th:href="@{/lib/bootstrap/dist/css/bootstrap.min.css}" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,900' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" type="text/css" href="/css/main.css" />
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#" th:href="@{/}">TODO</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="username" th:inline="text">[[${#httpServletRequest.remoteUser}]]</span>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" th:href="@{/logout}">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">

    <div class="form-group">
        <form id="newTodo" th:action="@{/todos/create}" th:object="${todoForm}" method="post" class="form-inline">
            <label class="sr-only" for="title">Title:</label>
            <input type="text" th:field="*{title}" placeholder="Title" class="form-control" />
            <label class="sr-only" for="note">Note:</label>
            <input type="text" th:field="*{note}" placeholder="Note" class="form-control" />
            <label class="sr-only" for="todoStateId">Status:</label>
            <select th:field="*{todoStateId}" class="form-control">
                <option th:each="state : ${allTodoStates}"
                        th:value="${state.id}"
                        th:text="${state.description}"></option>
            </select>
            <input type="submit" class="btn btn-primary" value="Save" />
            <div class="alert alert-warning" th:if="${#fields.hasErrors()}" th:errors="*">Error</div>
        </form>
    </div>

    <table id="todolist" class="table table-hover" th:if="${!#lists.isEmpty(allTodos)}">
        <thead>
        <th>Id</th>
        <th>Title</th>
        <th>Status</th>
        <th>Note</th>
        <th>&nbsp;</th>
        </thead>
        <tbody>
        <tr th:each="entity,rowStat : ${allTodos}">
            <td th:text="${entity.id}"></td>
            <td th:text="${entity.title}" th:attr="data-id=${entity.id}" data-edit-type="title"></td>
            <td th:text="${entity.todoState.description}"></td>
            <td th:text="${entity.note}" th:attr="data-id=${entity.id}" data-edit-type="note"></td>
            <td>
                <form class="form-inline" method="post" th:id="'delete' + ${entity.id}" th:action="@{/todos/__${entity.id}__/delete}">
                    <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#dialog_confirm_delete" th:attr="data-delete=${entity.id}">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Modal -->
    <div class="modal fade" id="dialog_confirm_delete" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
                        Warning</h4>
                </div>
                <div class="modal-body">
                    Are you sure to delete this TODO?
                </div>
                <div class="modal-footer">
                    <button type="button" class="negative btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="positive btn btn-danger" data-dismiss="modal" data-delete="#">Delete</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script th:src="@{/lib/jquery/dist/jquery.min.js}"></script>
<script th:src="@{/lib/bootstrap/dist/js/bootstrap.min.js}"></script>
<script th:src="@{/js/index.js}"></script>
</body>
</html>
